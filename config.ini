# ================================================================================
# PXGEONavQC Configuration File
# ================================================================================
# Quick Start Guide:
# 1. Set source type (Dual or Triple) in [General] section below
# 2. Adjust QC threshold values in [QC_Thresholds] section
# 3. Modify file patterns in [Rename_Raw_Files] and [Rename_Processed_Files] if needed
# 4. Set database output path in [Database] section
# ================================================================================


# ================================================================================
# GENERAL SETTINGS
# ================================================================================
[General]
# Source configuration: "Dual" or "Triple"
# - Dual: 2-gun array configuration
# - Triple: 3-gun array configuration
# This determines which COS (Center of Source) distance thresholds are applied
# IMPORTANT: Must match actual acquisition configuration
source_option = Triple

# ================================================================================
# QC THRESHOLDS
# Configure quality control limits for navigation and source data validation
# All thresholds can be adjusted to match project specifications
# Changes require application restart to take effect
# ================================================================================
[QC_Thresholds]
shot_increment = 2


# Shot Time Interval (STI) thresholds in seconds
# - ERROR: STI < sti_error_threshold OR STI > sti_warning_upper
# - WARNING: STI between sti_warning_lower and sti_warning_upper
# - OK: STI >= sti_error_threshold AND STI < sti_warning_lower
sti_error_threshold = 6.0
sti_warning_lower = 6.175
sti_warning_upper = 10.0

# Sub-array separation in meters
# Individual SP must be within sub_array_sep_min to sub_array_sep_max
sub_array_sep_min = 6.8
sub_array_sep_max = 9.2
# If more than sub_array_sep_percent_threshold (15%) of SP violate this, log to line log
sub_array_sep_percent_threshold = 15.0
# Sequence average must be within sub_array_sep_avg_min to sub_array_sep_avg_max
sub_array_sep_avg_min = 7.2
sub_array_sep_avg_max = 8.8

# Center of Source (COS) distance thresholds in meters
# For Dual source configuration
dual_cos_min = 33.75
dual_cos_max = 41.25

# For Triple source configuration
triple_cos_min = 33.75
triple_cos_max = 41.25

# Gun parameters
volume_nominal = 3040

# Gun depth thresholds (meters, negative = depth below surface)
gun_depth_min = -8.0
gun_depth_max = -6.0
gun_depth_nominal = -7.0

# Gun depth sensor average must be within gun_depth_sensor_min to gun_depth_sensor_max over entire sequence
gun_depth_sensor_min = -7.5
gun_depth_sensor_max = -6.5

# Gun depth deviation thresholds
# gun_depth_nominal_tolerance: Flag if >1m from nominal (-7.0m)
gun_depth_nominal_tolerance = 1.0
# gun_depth_avg_tolerance: Flag if >50cm from sequence average
gun_depth_avg_tolerance = 0.5

# Gun pressure thresholds (PSI)
gun_pressure_min = 1900
gun_pressure_max = 2100
gun_pressure_nominal = 2000

# Timing thresholds in seconds
timing_warning = 1.0
timing_error = 1.5

# Position accuracy limits in meters
crossline_limit = 10.0
radial_limit = 10.0
sma_limit = 3.0

# Consecutive error detection (legacy)
consecutive_error_limit = 25

# Advanced consecutive error detection for source errors
# Source errors = volume_flag OR gun_depth_flag OR gun_pressure_flag OR gun_timing_flag OR sma_flag = 2
# consec_error_window_7: 7 consecutive SP with source errors
consec_error_window_7 = 7
# consec_error_window_24: Window size for 12/24 check
consec_error_window_24 = 24
# consec_error_threshold_12_of_24: 12 SP with errors in 24 SP window
consec_error_threshold_12_of_24 = 12
# consec_error_window_40: Window size for 16/40 check
consec_error_window_40 = 40
# consec_error_threshold_16_of_40: 16 SP with errors in 40 SP window
consec_error_threshold_16_of_40 = 16
# consec_error_percent_total: 3% of total SP with source errors
consec_error_percent_total = 3.0


# ================================================================================
# FILE RENAMING PATTERNS - RAW FILES
# Pattern format: old_pattern -> new_pattern
# Example: 3184P31885.0.p190 -> 0256-3184P31885.p190
# ================================================================================
[Rename_Raw_Files]

# Expected file types and count
raw_expected_extensions = .p190, .p294, .S00, .p211, .mfa, .pdf, .sbs, .sts
raw_expected_file_number = 8

# Navigation and positioning files
p190_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.0\.p190$ -> 0256-\1\2.p190
p294_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.0\.p294$ -> 0256-\1\2.p294
s00_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.0\.S00$ -> 0256-\1\2.S00
p211_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.p211$ -> 0256-\1\2.p211

# Source and QC files
mfa_pattern = ^S(\d{4})\.(\d{4}[A-Z]\d)(\d{4})\.000\.mfa$ -> 0256-\2\3.mfa
pdf_pattern = ^S(\d{4})\.(\d{4}[A-Z]\d)(\d{4})\.000\.pdf$ -> 0256-\2\3_EOL_gator.pdf
sbs_pattern = ^S(\d{4})\.(\d{4}[A-Z]\d)(\d{4})\.000\.sbs$ -> 0256-\2\3.sbs
sts_pattern = ^S(\d{4})\.(\d{4}[A-Z]\d)(\d{4})\.000\.sts$ -> 0256-\2\3.sts


# ================================================================================
# FILE RENAMING PATTERNS - PROCESSED FILES
# ================================================================================
[Rename_Processed_Files]

# Expected file types and count
processed_expected_extensions = .pdf, .csv, .s01, .p111, .p190
processed_expected_file_number = 13

# Skip files that already match target format
already_compliant_pattern = ^0256-\d{4}[A-Z]\d\d{4}.*\.(csv|pdf|S01|P111|P190)$

# SPS comparison and QC files
sps_comp_csv_pattern = ^\d{4}\.\d+_(0256-\d{4}[A-Z]\d\d{4})_A1,A2,A3 - MT3007924_MMBC_SRC_20250316_1.s01_Compare.csv$ -> \1_SPS_Comp.csv
sps_point_depth_csv_pattern = ^\d{4}\.\d+_(0256-\d{4}[A-Z]\d\d{4})_A1,A2,A3_Attribute\.csv$ -> \1_SPS_Point_Depth.csv
sps_qc_pdf_pattern = ^QC_\d{4}\.\d+_(0256-\d{4}[A-Z]\d\d{4})\.pdf$ -> \1_SPS_QC.pdf

# EOL and processing reports
eol_report_csv_pattern = ^seq\d+_\d+_(\d{4}[A-Z]\d)(\d+)_EOL_report\.csv$ -> 0256-\1\2_EOL_report.csv
rgnss_pos_csv_pattern = ^seq\d+_\d+_(\d{4}[A-Z]\d)(\d+)_RGNSS_Pos_Output\.csv$ -> 0256-\1\2_RGNSS_Pos_output.csv
string_sep_csv_pattern = ^seq\d+_\d+_(\d{4}[A-Z]\d)(\d+)_String_Sep_SPR\.csv$ -> 0256-\1\2_String_Sep_SPR.csv
proc_report_pdf_pattern = ^seq\d+_\d+_(\d{4}[A-Z]\d)(\d+)_proc_report\.pdf$ -> 0256-\1\2_PROC_report.pdf
proc_plots_pdf_pattern = ^seq\d+_\d+_(\d{4}[A-Z]\d)(\d+)_PROC_plots\.pdf$ -> 0256-\1\2_PROC_plots.pdf
string_sep_pdf_pattern = ^seq\d+_\d+_(\d{4}[A-Z]\d)(\d+)_String_Sep_SPR\.pdf$ -> 0256-\1\2_String_Sep_SPR.pdf

# Processed navigation files
p190_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.P190$ -> 0256-\1\2.P190
p111_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.P111$ -> 0256-\1\2.P111
s01_pattern = ^(\d{4}[A-Z]\d)(\d{4})\.S01$ -> 0256-\1\2.S01

# Preserve already-correct filenames
proc_plots_nochange_pattern = ^(0256-\d{4}[A-Z]\d\d{4}_PROC_plots\.pdf)$ -> \1
string_sep_spr_nochange_pdf = ^(0256-\d{4}[A-Z]\d\d{4}_String_Sep_SPR\.pdf)$ -> \1
raw_sxx_nochange_pattern = ^(SR\d{4}-\d{4}[A-Z]\d\d{4}\.(P111|P190|S01))$ -> \1

# Alternative patterns for different naming conventions
p190_p111_s01_pattern = ^(\d{4}[A-Z]\d)(\d+)\.0\.(S01|P190|P111)$ -> 0256-\1\2.\3
seq_spr_csv_pattern = ^seq(\d+)_\d+_(\d{4}[A-Z]\d)\1_(String_Sep_SPR|RGNSS_Pos_Output|EOL_report)\.csv$ -> 0256-\2\1_\3.csv
sps_proc_plots_nochange = ^(0256-\d{4}[A-Z]\d\d{4}_PROC_plots\.pdf)$ -> \1
sps_string_spr_nochange = ^(0256-\d{4}[A-Z]\d\d{4}_String_Sep_SPR\.pdf)$ -> \1

# No-header variants
sps_qc_noheader_pdf = ^QC_4312.00_(\d{4}-\d{4}[A-Z]\d\d{4})\.0\.pdf$ -> \1_SPS_QC.pdf
sps_point_depth_noheader = ^4312.00_(\d{4}-\d{4}[A-Z]\d\d{4})\.0_A1,A2,A3_Attribute\.csv$ -> \1_SPS_Point_Depth.csv
sps_comp_noheader_csv = ^4312.00_(\d{4}-\d{4}[A-Z]\d\d{4})\.0_A1,A2,A3 - MT3007924_MMBC_SRC_20250316_1.s01_Compare.csv$ -> \1_SPS_Comp.csv


# ================================================================================
# FILE IDENTIFICATION PATTERNS
# Regular expressions used to identify specific file types during processing
# ================================================================================
[Regex_Filenames]

# SPS and navigation files
sps_file_pattern = ^0256-\d{4}[A-Z]\d\d{4}\.S01$
sps_file_noheader = ^0256-\d{4}[A-Z]\d\d{4}\.0\.S01$
sps_comp_file_pattern = ^0256-\d{4}[A-Z]\d\d{4}_SPS_Comp\.csv$
sps_eol_file_pattern = ^0256-\d{4}[A-Z]\d\d{4}_EOL_report\.csv$
sps_qc_pdf_pattern = ^0256-\d{4}[A-Z]\d\d{4}_SPS_QC\.pdf$
nav_linelog_pattern = ^0256-\d{4}[A-Z]\d\d{4}_Nav_LineLog\.xlsm$

# Report files
eol_file_pattern = ^0256-\d{4}[A-Z]\d\d{4}_EOL_report\.csv$
sbs_file_pattern = ^0256-\d{4}[A-Z]\d\d{4}\.sbs$

# Output file naming
png_suffix = _A1-A3vsPP_Snapshot.png


# ================================================================================
# DATA IMPORT SETTINGS
# Configuration for reading different file formats
# ================================================================================
[SPS_Import]
# Number of header rows to skip when importing SPS (.S01) files
header_rows = 194

[ASC_Import]
# ASC file import configuration (gun data files)
skip_rows = 4
header_rows = 1
asc_gun_pattern = ^String_\d+-Cluster_\d+-Gun_\d+$


# ================================================================================
# LINE LOG SETTINGS
# Configuration for updating Excel (.xlsm) line log files
# ================================================================================
[LineLog]
acquisition_comments_label = Acquisition and Processing Comments
max_open_attempts = 5

# Cell mapping for metadata extraction
cell_filename = C6
cell_line = C7
cell_sequence = C8
cell_attempt = C9
cell_heading = E8

# Shot point marker search configuration
marker_search_column = F
marker_search_start_row = 18
marker_search_end_row = 50

# Shot increment for production SP calculation
# Note: shot_increment is also defined in [QC_Thresholds] - this value takes precedence for line log calculations
shot_increment = 2

# Marker timing validation thresholds (in minutes)
# Compare line log manual entry time vs SPS data time for markers (FASP, FGSP, LGSP, FOSP, LOSP)
# Format: HH:MM (no seconds)
marker_time_warning_threshold = 2
marker_time_error_threshold = 5

dither_file =  N:\05_Internal_use_only\Scripts\PXGEONavQC_Version30\5-1_MT3007924_MMBC_TimeDithers.txt

# ================================================================================
# DATABASE SETTINGS
# Configure output paths for QC database files
# ================================================================================
[Database]
# Primary database path (network location preferred)
# Application tries to save database CSV here first
# Example: N:\30_SWAT_DBB or C:\SWAT_DB_Local
primary_db_path = N:\30_SWAT_DB

# Fallback database path (local location if network unavailable)
# If primary path fails (permissions, network issues), database is saved here
# Recommended: Use local path with guaranteed write access
fallback_db_path = C:\SWAT_DB_Local

# Automatically create fallback directory if it doesn't exist
create_fallback_if_missing = true


# ================================================================================
# LEGACY PATHS (Retained for backward compatibility)
# ================================================================================
[Paths]
db_output_path = N:\30_SWAT_DB


# ================================================================================
# End of Configuration File
# ================================================================================